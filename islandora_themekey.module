<?php

/**
 * @file
 * Contains hooks implemented by Islandora Themekey.
 */

/**
 * Implements hook_themekey_properties().
 */
function islandora_themekey_themekey_properties() {
  $attributes = array();
  $attributes['islandora:ismemberofcollection'] = array(
    'description' => t('Islandora object is member of collection'),
    'validator' => 'islandora_themekey_validator_ismemberofcollection',
    'file' => 'islandora_themekey_validators.inc',
    'page cache' => THEMEKEY_PAGECACHE_SUPPORTED,
  );

  return array('attributes' => $attributes, 'maps' => array());
}

/**
 * Implements hook_themekey_global().
 */
function islandora_themekey_themekey_global() {
  $parameters = array();
  // Get the PID, if there is one. @todo: Accommodate paths that do not
  // contain an explicit PID, like those generated by Islandora Pathauto.
  if (count(arg()) > 1) {
    $pid = arg(2);
    if ($islandora_object = islandora_object_load($pid)) {
      $collections = $islandora_object->relationships->get(FEDORA_RELS_EXT_URI, 'isMemberOfCollection');
      // islandora:root will be a member of 0 collections, so we check for this.
      if (count($collections)) {
        // Can't find an example of this value as an array, only as a
        // string. For now, we only check the first collection in the
        // list of all collections the Islandora object is in.
        $collection = $collections[0]['object']['value'];
        $parameters['islandora:ismemberofcollection'] = $collection;
      }
    }
  }
  return $parameters;
}
